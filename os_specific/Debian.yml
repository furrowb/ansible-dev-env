---
- name: Install git
  apt:
    name: git
    state: latest
- name: Install zsh
  apt:
    name: zsh
    state: latest
- name: Install vim
  apt:
    name: vim
    state: latest
- name: Check for VSCode
  command: dpkg-query -W code
  register: check_vscode
  failed_when: check_vscode.rc > 1
  changed_when: check_vscode.rc == 1
- name: Retrieve VSCode
  get_url:
    url: https://go.microsoft.com/fwlink/?LinkID=760868
    dest: "{{ ansible_env.HOME }}/Downloads/vscode.deb"
  when: check_vscode.changed
- name: Install VSCode
  apt: deb="{{ ansible_env.HOME }}/Downloads/vscode.deb"
  sudo: true
  when: check_vscode.changed
- name: Remove VSCode download
  file:
    path: "{{ ansible_env.HOME }}/Downloads/vscode.deb"
    state: absent